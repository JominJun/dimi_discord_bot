import discord, os, time, datetime, get_riot_api as rp
from discord.ext import commands
from discord.utils import get

app = commands.Bot(command_prefix="~", status=discord.Status.online, activity=discord.Game("'~ëª…ë ¹ì–´' ëŒ€ê¸°"))
token = os.getenv('DISCORD_BOT_DIMI1537_TOKEN')
caller = ""
onActivity = ""

@app.event
async def on_ready():
    print(f"{app.user.name}({app.user.id})ì˜ ìž‘ë™ì„ ì‹œìž‘í•©ë‹ˆë‹¤")

@app.event
async def on_member_join(member):
    await member.send("1í•™ë…„ 5ë°˜ ë””ìŠ¤ì½”ë“œ ë°©ì— ë“¤ì–´ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤")

@app.event
async def on_reaction_add(reaction, user):
    global caller, onActivity
    caller = caller.split("#")[0]

    if onActivity == "LoL":
        if user.bot or user.name != caller:
            return None
        if str(reaction.emoji) == "1ï¸âƒ£":
            embed = discord.Embed(color=0xed1280)
            embed.add_field(name="~ë¡¤ ì •ë³´ í‹°ì–´", value="'~ë¡¤ ì •ë³´ í‹°ì–´ [ì‚¬ìš©ìžë‹‰ë„¤ìž„]'ì„ ìž…ë ¥í•˜ì—¬ ì‚¬ìš©ìžì˜ í‹°ì–´ë¥¼ ì•Œ ìˆ˜ ìžˆìŒ")
            embed.set_footer(text="ê°œë°œë‹´ë‹¹ìž: â­ì•¡ê´´ìœ íŠœë²„ì§€í˜œ, ë„í—Œ ë”°ê¹Œë¦¬ ê·œíƒœ")
            await reaction.message.channel.send(embed=embed)
        if str(reaction.emoji) == "2ï¸âƒ£":
            embed = discord.Embed(color=0xed1280)
            embed.add_field(name="~ë¡¤ ì •ë³´ ë ˆë²¨", value="'~ë¡¤ ì •ë³´ ë ˆë²¨ [ì‚¬ìš©ìžë‹‰ë„¤ìž„]'ì„ ìž…ë ¥í•˜ì—¬ ì‚¬ìš©ìžì˜ ë ˆë²¨ì„ ì•Œ ìˆ˜ ìžˆìŒ")
            embed.set_footer(text="ê°œë°œë‹´ë‹¹ìž: â­ì•¡ê´´ìœ íŠœë²„ì§€í˜œ, ë„í—Œ ë”°ê¹Œë¦¬ ê·œíƒœ")
            await reaction.message.channel.send(embed=embed)
        if str(reaction.emoji) == "âŒ":
            await reaction.message.channel.send(user.mention+"ë‹˜, ì·¨ì†Œë¨~")
            onActivity = ""
            return None

@app.command()
async def ëª…ë ¹ì–´(ctx):
    embed = discord.Embed(color=0xed1280)
    embed.set_author(name="1537 ìµœì§€í˜œ ëª…ë ¹ì–´", icon_url="https://imgur.com/Tbu3Bnm.png")
    embed.add_field(name="âœ… ê¸°ë³¸ì •ë³´", value="ì§€í˜œë¥¼ ì†Œí™˜í•  ë•ŒëŠ” ì•žì— '~'ì„ ë¶™ì—¬ì„œ ì†Œí™˜í•©ë‹ˆë‹¤", inline=False)
    embed.add_field(name="ðŸŽ‰ ìœ ëž˜", value="ë¯¼ì œê°€ ë¯¼ìž¬ì— ëŒ€í•œ ë°˜ê²©ìœ¼ë¡œ ì§€í˜œë¼ê³  ë¶€ë¥´ë©´ì„œ ë‚œ íƒœì–´ë‚¬ìŒ! ~~~", inline=False)
    embed.add_field(name="~ëª…ë ¹ì–´", value="ëª…ë ¹ì–´ ëª©ë¡ì„ ë³´ì—¬ì¤Œ")
    embed.add_field(name="~ë¡¤", value="ë¡¤ ê´€ë ¨ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìžˆìŒ")
    embed.add_field(name="~ì‹œê°„í‘œ", value="ì˜¤ëŠ˜ì˜ ì‹œê°„í‘œë¥¼ í™•ì¸í•  ìˆ˜ ìžˆìŒ")
    embed.add_field(name="~ì§€í˜œì•¼", value="ë‚  ë¶ˆëŸ¬ë‚¼ ìˆ˜ ìžˆìŒ")
    embed.add_field(name="~ì–´ë–¡í• ê±°ìž„", value="ê¶ê¸ˆí•´? ê¶ê¸ˆí•˜ë©´...")
    embed.add_field(name="~ì–¼êµ´", value="ì œ ì–¼êµ´ì€...")
    embed.add_field(name="~ë‚˜ëŠ”?", value="ë„ˆëŠ”... ëˆ„êµ´ê¹Œ?")
    embed.add_field(name="~ì§€í˜œëŠ”?", value="ë¹„ë°€")
    embed.add_field(name="~ì²­ì†Œ", value="'ì²­ì†Œ [ìˆ«ìž]' ìž…ë ¥ìœ¼ë¡œ ë©”ì„¸ì§€ë¥¼ ì‚­ì œí•  ìˆ˜ ìžˆìŒ")
    embed.add_field(name="~ë„ë°°", value="ì²­ì†Œí•  ìˆ˜ ìžˆë‹¤ë©´... ë„ë°°ê°€ ê· í˜•ì„ ì´ë£¨ì–´ì¤˜ì•¼ì£ ")
    embed.add_field(name="~ã…‹", value="ã…‹ã…‹ã…‹ã…‹ã…‹")
    embed.set_footer(text="ë‹´ë‹¹ìž: â­ì¡°ë¯¼ì¤€")
    await ctx.send(embed=embed)

@app.command()
async def ì§€í˜œì•¼(ctx):
    await ctx.send("ëˆ„ê°€ ë‚˜ ë¶ˆë €ìŒ?")

@app.command()
async def ì–´ë–¡í• ê±°ìž„(ctx):
    await ctx.send("ì–´ë–¡í• ê±°ìž„ ã… ã… ")

@app.command(name="ã…‹")
async def _z(ctx):
    await ctx.send("ã…‹ã…Œã…Œã…‹ã…Œã…‹ã…‹ã…Œã…‹ã…‹ã…‹ã…Œã…‹ã…Œã…‹ã…‹ã…‹ã…‹")

@app.command(name="ì§€í˜œëŠ”?")
async def _whoami(ctx):
    await ctx.send("ì–‘í‰ ì†Œë…€ ìµœì§€í˜œì•¼ ><")

@app.command()
async def ì–¼êµ´(ctx):
    embed = discord.Embed(color=0xed1280)
    embed.set_thumbnail(url="https://imgur.com/Tbu3Bnm.png")
    await ctx.send(embed=embed)

@app.command()
@commands.has_permissions(administrator=True)
async def ì„ ê³ (ctx, member: discord.Member = None):
    member = member or ctx.message.author
    isAdmin = False
    for item in ctx.message.author.roles:
        if str(item) == "ê´€ë¦¬ìž":
            isAdmin = True

    if isAdmin:
        await member.add_roles(get(ctx.guild.roles, name="ì£„ìˆ˜"))
        await ctx.channel.send(f"{member.mention}ëŠ” ë²•ì›ì—ì„œ ì •ë‹¹í•œ ì ˆì°¨ë¥¼ ê±°ì³ ì„ ê³ ë˜ì—ˆìœ¼ë©°, ì•žìœ¼ë¡œ 'ì£„ìˆ˜' í˜¸ì¹­ì„ ê°–ê²Œ ë©ë‹ˆë‹¤")
    else:
        await ctx.channel.send(f"ê´€ë¦¬ìžë§Œì´ ì„ ê³ í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤")
        
@ì„ ê³ .error
async def _kick_error(ctx, error):
    if isinstance(error, commands.MissingPermissions):
        await ctx.send("{}ë‹˜, ë‹¹ì‹ ì€ ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì‹¤ ê¶Œí•œì´ ì—†ìŒ~".format(ctx.message.author))
    if isinstance(error, commands.BadArgument):
        await ctx.send(f"{ctx.message.author.mention}ë‹˜, ì„ ê³ í•  ëŒ€ìƒìžë¥¼ ì°¾ì§€ ëª»í–ˆìŒ~\në„ì–´ì“°ê¸°ê°€ ìžˆìœ¼ë©´ '[ì„ ê³ ëŒ€ìƒìž]'ì²˜ëŸ¼ ë¬¶ì–´ì£¼ì…ˆ~")

@app.command(name="ë‚˜ëŠ”?")
async def _info(ctx):
    member = ctx.message.author
    if member is not None:
        embed = discord.Embed(color=0xed1280)
        embed.set_author(name=f"{str(ctx.message.author).split('#')[0]}")
        embed.set_thumbnail(url="https://imgur.com/Tbu3Bnm.png")
        status = ""
        for item in member.roles:
            if str(item) != "@everyone":
                if item != member.roles[1]:
                    status += " | "+str(item)
                else:
                    status += str(item)
        embed.add_field(name="ì§ìœ„", value=status)
        await ctx.channel.send(embed=embed)

@app.command()
async def ì²­ì†Œ(ctx, amount: int = 10):
    await ctx.channel.purge(limit=amount+1)
    embed = discord.Embed()
    embed.add_field(name="ì²­ì†Œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤")

@app.command()
async def ì†Œí˜„ì•„(ctx):
    await ctx.send(f"ì§€ê¸ˆ... ë‚˜ë¥¼ ì•žì— ë‘ê³ ... ë‹¤ë¥¸ ì—¬ìž ì°¾ëŠ”ê±°ì•¼?")

@app.command()
async def ë„ë°°(ctx, *args):
    if len(args) >= 2:
        if 1 <= int(args[1]) <= 20:
            for _ in range(int(args[1])):
                await ctx.send(args[0])
                time.sleep(0.4)
            embed = discord.Embed(color=0xed1280)
            embed.set_thumbnail(url="https://imgur.com/Tbu3Bnm.png")
            await ctx.send(embed=embed)
            await ctx.send("ì°¡ê¸‹ ><")
        else:
            await ctx.send(f"{ctx.author.mention}ë‹˜, 1~20 ì‚¬ì´ì˜ ìˆ«ìžë¥¼ ë„£ì–´ì£¼ì‚¼!")
    else:
        embed = discord.Embed(color=0xed1280)
        embed.set_author(name="'ë„ë°°' ëª…ë ¹ì–´ ì‚¬ìš©ë²•", icon_url="https://imgur.com/OjEkXk9.png")
        embed.add_field(name="~ë„ë°° [ë„ë°°í•  ë‹¨ì–´] [ë„ë°°í•  íšŸìˆ˜(1~20)]", value="ìœ„ì™€ ê°™ì€ í˜•íƒœê°€ ê¸°ë³¸ìž„", inline=False)
        embed.set_footer(text="ê°œë°œë‹´ë‹¹ìž: â­1528 ì¡°ë¯¼ì¤€")
        await ctx.send(embed=embed)

@app.command()
async def ì‹œê°„í‘œ(ctx):
    schedule = [
        ["ìžë£Œêµ¬ì¡°B", "í†µí•©ê³¼í•™", "í†µí•©ì‚¬íšŒ", "ìˆ˜í•™", "ìžë£Œêµ¬ì¡°A", "ì²´ìœ¡", "êµ­ì–´", "ì¢…ë¡€"],
        ["ì»´í“¨í„°ì‹œìŠ¤í…œì¼ë°˜", "ë¯¸ìˆ ", "ë¯¸ìˆ ", "ì˜ì–´(ê³µ)", "ìˆ˜í•™", "ì§„ë¡œ(CA)", "ì§„ë¡œ(CA)", "ì¢…ë¡€"],
        ["í†µí•©ì‚¬íšŒ", "ì»´í“¨í„°ì‹œìŠ¤í…œì¼ë°˜", "í†µí•©ê³¼í•™", "ë¯¸ìˆ ", "ì²´ìœ¡", "êµ­ì–´", "ì¢…ë¡€"],
        ["ì§„ë¡œ", "ìžë£Œêµ¬ì¡°A", "ìžë£Œêµ¬ì¡°B", "ìžë£Œêµ¬ì¡°B", "í†µí•©ê³¼í•™", "ì˜ì–´(ê³µ)", "HR", "ì¢…ë¡€"],
        ["ìžë£Œêµ¬ì¡°A", "ìžë£Œêµ¬ì¡°A", "ìˆ˜í•™", "í†µí•©ì‚¬íšŒ", "ì»´í“¨í„°ì‹œìŠ¤í…œì¼ë°˜", "êµ­ì–´", "ì˜ì–´(ì „)", "ì¢…ë¡€"]
    ]
    schedule_link = {
        "êµ­ì–´": "",
        "ìˆ˜í•™": "",
        "í†µí•©ì‚¬íšŒ": "",
        "í†µí•©ê³¼í•™": "",
        "ì˜ì–´(ê³µ)": "",
        "ì˜ì–´(ì „)": "",
        "ì»´í“¨í„°ì‹œìŠ¤í…œì¼ë°˜": "",
        "ìžë£Œêµ¬ì¡°A": "",
        "ìžë£Œêµ¬ì¡°B": "",
        "ë¯¸ìˆ ": "",
        "ì²´ìœ¡": "",
        "ì§„ë¡œ": "",
        "ì¡°íšŒ": "",
        "ì¢…ë¡€": "",
        "ì§„ë¡œ(CA)": "",
        "ë™ì•„ë¦¬(CA)": "",
        "HR": ""
    }
    embed = discord.Embed(color=0xed1280)
    embed.set_author(name="1í•™ë…„ 5ë°˜ ì‹œê°„í‘œ", icon_url="https://imgur.com/OjEkXk9.png")
    for period in range(1,8):
        period_subject = schedule[datetime.datetime.now().weekday()][period - 1]
        embed.add_field(name=f"{period}êµì‹œ - {period_subject}", value=f"{schedule_link.get(period_subject)}", inline=False)
    await ctx.send(embed=embed)

@app.command()
async def ë¡¤(ctx, *args):
    if len(args):
        cmdType = args[0]
        if cmdType == "ì •ë³´":
            detailType = args[1]
            summonerName = args[2]
            if detailType == "í‹°ì–´":
                await ctx.send(f"{rp.getRankInfoByName(summonerName).get('tier')} {rp.getRankInfoByName(summonerName).get('rank')}")
            elif detailType == "ë ˆë²¨":
                await ctx.send(f"Level {rp.getSummonerInfoByName(summonerName, 'summonerLevel')}")
        elif cmdType == "ë„ì›€":
            global caller, onActivity
            onActivity = "LoL"
            caller = str(ctx.author)
            embed = discord.Embed(color=0xed1280)
            embed.set_author(name="1í•™ë…„ 5ë°˜ ë¡¤ ë„ìš°ë¯¸", icon_url="https://imgur.com/gBqtQPN.png")
            embed.add_field(name="~ë¡¤ [cmdType] [detailType] [summonerName]", value="ìœ„ì™€ ê°™ì€ í˜•íƒœê°€ ê¸°ë³¸ìž„", inline=False)
            embed.add_field(name="~ë¡¤ ì •ë³´", value="detailType: í‹°ì–´ | ë ˆë²¨")
            embed.add_field(name="~ë¡¤ ë„ì›€", value="detailTypeì´ ì—†ìŒ")
            embed.add_field(name="ì¶”ê°€ ì„¤ëª… ì›í•¨?", value=":one: ~ë¡¤ ì •ë³´ í‹°ì–´ :two: ~ë¡¤ ì •ë³´ ë ˆë²¨ :x: ì›í•˜ì§€ ì•ŠìŒ", inline=False)
            embed.set_footer(text="ê°œë°œë‹´ë‹¹ìž: â­ì•¡ê´´ìœ íŠœë²„ì§€í˜œ, ë„í—Œ ë”°ê¹Œë¦¬ ê·œíƒœ")
            msg = await ctx.send(embed=embed)
            await msg.add_reaction("1ï¸âƒ£")
            await msg.add_reaction("2ï¸âƒ£")
            await msg.add_reaction("âŒ")
    else:
        await ctx.send("'~ë¡¤ ë„ì›€'ì„ ìž…ë ¥í•˜ì—¬ ìžì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì…ˆ")

app.run(token)
